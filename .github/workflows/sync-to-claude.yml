name: Sync to Claude

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:  # Manuel tetikleme iÃ§in

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        
      - name: Create repository bundle
        run: |
          # node_modules ve .git hariÃ§ her ÅŸeyi zip'le
          zip -r repo-bundle.zip . \
            -x ".git/*" \
            -x "node_modules/*" \
            -x ".next/*" \
            -x "*.log" \
            -x ".env*"
          
          echo "âœ… Bundle created: $(ls -lh repo-bundle.zip | awk '{print $5}')"
      
      - name: Upload to transfer.sh (14 days storage)
        id: upload
        run: |
          echo "ðŸ“¤ Uploading to transfer.sh..."
          RESPONSE=$(curl --upload-file repo-bundle.zip https://transfer.sh/repo-bundle.zip)
          echo "Response: $RESPONSE"
          
          # transfer.sh direkt URL dÃ¶ndÃ¼rÃ¼r
          DOWNLOAD_URL="$RESPONSE"
          echo "download_url=$DOWNLOAD_URL" >> $GITHUB_OUTPUT
          
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ðŸ“¦ REPO BUNDLE READY!"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ðŸ”— Download URL:"
          echo "$DOWNLOAD_URL"
          echo ""
          echo "â° Valid for: 14 days"
          echo "ðŸ“Š Commit: ${{ github.sha }}"
          echo "ðŸŒ Service: transfer.sh"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      
      - name: Create summary
        run: |
          echo "## ðŸ“¦ Repository Bundle Created" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Download URL:** ${{ steps.upload.outputs.download_url }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Commit:** \`${{ github.sha }}\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Branch:** \`${{ github.ref_name }}\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Valid for:** 14 days" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Service:** transfer.sh (more reliable than file.io)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Copy this URL and send it to Claude to sync the repository." >> $GITHUB_STEP_SUMMARY
